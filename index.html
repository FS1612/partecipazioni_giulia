<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Partecipazione Matrimonio Giulia & Giovanni</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Varela+Round&display=swap" rel="stylesheet">

<style>
body{
    height: 100vh;
    display:flex;
    justify-content: center;
    align-items: center;
    background-color: #e9f5db;
}

input#flap{
    display: none;
}

.envelope-container{
    position: relative;
}

.envelope-back{
    position: relative;
    width:320px;
    height: 200px;
    background-color: #718355;
}

.envelope-back:before{
    content:"" ;
    position: absolute;
    background-color: rgba(0,0,0,0.07);
    width:320px;
    height:10px;
    border-radius: 50%;
    top:220px; 
}

.card{
    position: absolute;
    width: 300px;
    height: 180px;
    background-color: white;
    top: 10px;
    left: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    cursor:pointer;
    z-index: 5;

    transition:
        top .8s cubic-bezier(.25,.46,.45,1.4),
        left .8s cubic-bezier(.25,.46,.45,1.4),
        width .8s cubic-bezier(.25,.46,.45,1.4),
        height .8s cubic-bezier(.25,.46,.45,1.4),
        box-shadow .4s ease,
        opacity .3s ease;
}

/* BLOCCO CLICK QUANDO FLAP CHIUSA */
#flap:not(:checked) ~ .card {
    pointer-events: none;
    opacity: 0.001;
    z-index: 1;
}

/* FASE 1: esce verso l’alto */
.card.open {
    top: -240px;
    z-index: 2000;
    box-shadow: 0 20px 30px rgba(0,0,0,0.25);
}

/* FASE 2: si espande sopra la busta */
.card.open2 {
    left: 0;
    width: 320px;
    height: 200px;
    z-index: 3000;
    box-shadow: 0 25px 40px rgba(0,0,0,0.35);
}

/* Usata DURANTE il rientro */
.card.closing {
    z-index: 3000;
}

/* Aletta inferiore */
.card-front{
    position:absolute;
    width: 0;
    height: 0;
    border-bottom: 100px solid #87986a;
    border-left: 160px solid transparent;
    border-right:160px solid transparent;
    top: 100px;
    left:0;
    z-index:10;
    pointer-events: none;
}

.card-front::before,
.card-front::after{
    content:"";
    position: absolute;
    border-bottom:100px solid transparent;
    border-top: 100px solid transparent;
    height:0;
    width: 0;
}

.card-front::before {
    border-left: 161px solid transparent;
    border-right:161px solid #97a97c;
    top:-100px;
    left:-162px;
}

.card-front::after {
    border-right: 161px solid transparent;
    border-left:161px solid #97a97c;
    top:-100px;
    left:-160px;
}

/* Aletta superiore */
.flap{
    position:absolute;
    width: 0;
    height: 0;
    border-top: 110px solid #b6c99a;
    border-left: 160px solid transparent;
    border-right: 160px solid transparent;
    top:0;
    left: 0;
    z-index: 8;
    cursor:pointer;
    transition:.3s;
    transform-origin: top;
}

#flap:checked + .flap{
    transform:rotateX(180deg);
}

/* TESTO CENTRATO SULL'ALETTA */
.flap-text {
    position: absolute;
    top: 2px;
    left: 50%;
    transform: translateX(-50%);
    width: 260px;
    text-align: center;
    font-size: 18px;
    font-style: italic;
    font-family: "Dancing Script";
    color: #fff;
    pointer-events: none;
    z-index: 20;
    opacity: 1;
    transition: opacity .3s ease;
}
#flap:checked ~ .flap-text {
    opacity: 0;
    transition: opacity .3s ease;
}
/* ================= SIGILLO ================ */

.seal-container {
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 160px;
    height: 160px;
    z-index: 20;
    pointer-events: none;
}

.wax-seal,
.wax-seal-broken {
    position: absolute;
    width: 100%;
    height: 100%;
    transition:
        opacity .4s ease-out,
        transform .4s cubic-bezier(.25,.46,.45,1.4);
}

/* SIGILLO INTERO → leggero shrink quando si rompe */
.wax-seal {
    transform: scale(1);
}

/* SIGILLO ROTTO → inizialmente nascosto */
.wax-seal-broken {
    opacity: 0;
    transform: scale(0.6) rotate(-8deg);
}

/* Quando la busta si apre (rottura) */
#flap:checked ~ .seal-container .wax-seal {
    opacity: 0;
    transform: scale(0.7) rotate(4deg); /* shrink + twist */
}

#flap:checked ~ .seal-container .wax-seal-broken {
    opacity: 1;
    transform: scale(1) rotate(0deg); /* entra morbido */
}
/* Se il sigillo è già rotto, non tornare integro */
.seal-broken-permanently .wax-seal {
    opacity: 0 !important;
}

.seal-broken-permanently .wax-seal-broken {
    opacity: 1 !important;
    transform: scale(1) rotate(0deg) !important;
}
</style>
</head>
<body>

<div class="envelope-container">
    
   <input id="flap" type="checkbox">
   <label class="flap" for="flap"></label>
    
   <!-- TESTO CORRETTO -->
   <div class="flap-text">A chi condividerà con noi questo giorno speciale</div>
    
   <div class="envelope-back"></div>

    <!-- SIGILLO DENTRO LA BUSTA -->
    <div class="seal-container">
        <img src="sigillo.png" class="wax-seal">
        <img src="sigillo_rotto.png" class="wax-seal-broken">
    </div>
    
   <div class="card">Thanks!</div>

   <div class="card-front"></div>

</div>

<script>
const card = document.querySelector('.card');
const flap = document.getElementById('flap');
const flapLabel = document.querySelector('.flap');
const sealContainer = document.querySelector('.seal-container');
let sealBroken = false;
card.addEventListener('click', () => {

    /* RIENTRO */
    if(card.classList.contains('open2')){
        
        card.style.zIndex = '9';
        card.classList.add('closing');
        card.classList.remove('open2');

        setTimeout(()=>{
            card.classList.remove('open');
        },20);

        setTimeout(()=>{
            flap.style.zIndex = '10';
            card.classList.remove('closing');
        },850);

        return;
    }

    /* USCITA - FASE 1 */
    card.classList.add('open');
    card.style.zIndex = '9';

    /* USCITA - FASE 2 */
    setTimeout(()=>{
        card.classList.add('open2');
    },700);
});

/* IMPEDISCI CHIUSURA FLAP */
flapLabel.addEventListener("click", e=>{
    if(flap.checked && (card.classList.contains("open") || card.classList.contains("open2"))){
        e.preventDefault();
    }
});
flap.addEventListener("change", () => {
    if(flap.checked && !sealBroken){
        sealBroken = true;
        sealContainer.classList.add("seal-broken-permanently");
    }
});

</script>

</body>
</html>
